<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Formatting Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .job-item { margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>Job Data Formatting Test</h1>
    
    <div class="test-section">
        <h2>Sample Job Data (Your API Format)</h2>
        <div id="formatted-jobs"></div>
    </div>

    <script>
        // Your sample job data from the API response
        const sampleJobData = {
            job_id: 'P1d8JWwc7nj7HjQ1AAAAAA==',
            job_title: 'Software Developer',
            employer_name: 'Peraton',
            employer_logo: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSj274rH0OoVvsmnxHFvhCnhdbMzJOe3pvy_HEL&s=0',
            job_city: 'Washington',
            job_state: 'District of Columbia',
            job_country: 'US',
            job_min_salary: 146000,
            job_max_salary: 234000,
            job_salary_period: 'YEAR',
            job_posted_at_datetime_utc: '2025-08-18T00:00:00.000Z',
            job_posted_at_timestamp: 1755475200,
            job_description: 'Minimum of 12 years with BS/BA; Minimum of 10 years with MS/MA...'
        };

        // Formatting functions (copied from your updated script.js)
        function formatLocation(job) {
            if (job.job_city && job.job_state) {
                return `${job.job_city}, ${job.job_state}`;
            } else if (job.job_city) {
                return job.job_city;
            } else if (job.job_country) {
                return job.job_country;
            }
            return 'Location not specified';
        }
        
        function formatSalary(job) {
            // Handle yearly salary
            if (job.job_min_salary && job.job_max_salary) {
                const period = job.job_salary_period === 'YEAR' ? '/year' : '';
                return `$${job.job_min_salary.toLocaleString()} - $${job.job_max_salary.toLocaleString()}${period}`;
            } else if (job.job_min_salary) {
                const period = job.job_salary_period === 'YEAR' ? '/year' : '';
                return `$${job.job_min_salary.toLocaleString()}+${period}`;
            } else if (job.job_salary) {
                return job.job_salary;
            }
            return 'Salary not specified';
        }
        
        function formatDate(dateString) {
            if (!dateString) return 'Recently posted';
            
            try {
                const date = new Date(dateString);
                const now = new Date();
                const diffTime = Math.abs(now - date);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                if (diffDays === 0) return 'Today';
                if (diffDays === 1) return 'Yesterday';
                if (diffDays < 7) return `${diffDays} days ago`;
                if (diffDays < 30) return `${Math.floor(diffDays / 7)} weeks ago`;
                if (diffDays < 365) return `${Math.floor(diffDays / 30)} months ago`;
                
                return date.toLocaleDateString();
            } catch (error) {
                // Handle posted_at_timestamp (Unix timestamp)
                if (typeof dateString === 'number') {
                    try {
                        const date = new Date(dateString * 1000);
                        const now = new Date();
                        const diffTime = Math.abs(now - date);
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        
                        if (diffDays === 0) return 'Today';
                        if (diffDays === 1) return 'Yesterday';
                        if (diffDays < 7) return `${diffDays} days ago`;
                        if (diffDays < 30) return `${Math.floor(diffDays / 7)} weeks ago`;
                        if (diffDays < 365) return `${Math.floor(diffDays / 30)} months ago`;
                        
                        return date.toLocaleDateString();
                    } catch (timestampError) {
                        return 'Recently posted';
                    }
                }
                return 'Recently posted';
            }
        }

        // Convert API data to display format
        function convertJobData(apiJob) {
            return {
                id: apiJob.job_id,
                title: apiJob.job_title,
                company: apiJob.employer_name,
                location: formatLocation(apiJob),
                salary: formatSalary(apiJob),
                posted: formatDate(apiJob.job_posted_at_datetime_utc),
                posted_timestamp: formatDate(apiJob.job_posted_at_timestamp),
                description: apiJob.job_description,
                // Keep original fields for compatibility
                job_min_salary: apiJob.job_min_salary,
                job_max_salary: apiJob.job_max_salary,
                job_salary_period: apiJob.job_salary_period,
                job_posted_at_datetime_utc: apiJob.job_posted_at_datetime_utc,
                job_posted_at_timestamp: apiJob.job_posted_at_timestamp
            };
        }

        // Display the formatted data
        const formattedJob = convertJobData(sampleJobData);
        const container = document.getElementById('formatted-jobs');
        
        container.innerHTML = `
            <div class="job-item">
                <h3>${formattedJob.title}</h3>
                <p><strong>Company:</strong> ${formattedJob.company}</p>
                <p><strong>Location:</strong> ${formattedJob.location}</p>
                <p><strong>Salary:</strong> ${formattedJob.salary}</p>
                <p><strong>Posted (from UTC date):</strong> ${formattedJob.posted}</p>
                <p><strong>Posted (from timestamp):</strong> ${formattedJob.posted_timestamp}</p>
            </div>
            
            <div class="job-item">
                <h4>Raw API Data:</h4>
                <pre>${JSON.stringify(sampleJobData, null, 2)}</pre>
            </div>
        `;

        console.log('Formatted Job Data:', formattedJob);
    </script>
</body>
</html>
